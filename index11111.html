<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>reuseIT Electronics - Web3 Edition</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ethers.js for blockchain interaction -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"
      type="application/javascript"
    ></script>
    <!-- Google Fonts for aesthetic typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .logo {
        font-family: "Pacifico", cursive;
      }
      #notification,
      #checkout-modal,
      #ideas-modal,
      #chatbot-window {
        transition: all 0.3s ease-in-out;
      }
      .modal-content {
        transition: transform 0.3s ease-in-out;
      }
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #4f46e5;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-800">
    <!-- Header and Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
      <nav
        class="container mx-auto px-6 py-4 flex justify-between items-center"
      >
        <div class="flex items-center space-x-2">
          <svg
            class="h-8 w-8 text-indigo-600"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20Z" />
            <path d="M15.49 10.51a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h.01" />
            <path d="M8.51 10.51a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-.01" />
            <path d="M12 18a4 4 0 0 0 4-4H8a4 4 0 0 0 4 4Z" />
          </svg>
          <h1 class="logo text-3xl text-indigo-600">reuseIT</h1>
        </div>
        <ul class="hidden md:flex items-center space-x-2 text-lg">
          <li>
            <a
              href="#home"
              class="nav-link px-4 py-2 rounded-full hover:bg-indigo-100 transition-colors"
              >Home</a
            >
          </li>
          <li>
            <a
              href="#shop"
              class="nav-link px-4 py-2 rounded-full hover:bg-indigo-100 transition-colors"
              >Shop</a
            >
          </li>
          <li>
            <a
              href="#sell"
              class="nav-link px-4 py-2 rounded-full hover:bg-indigo-100 transition-colors"
              >Sell</a
            >
          </li>
          <li>
            <a
              href="#diy"
              class="nav-link px-4 py-2 rounded-full hover:bg-indigo-100 transition-colors"
              >DIY Studio</a
            >
          </li>
          <li>
            <a
              href="#auction"
              class="nav-link px-4 py-2 rounded-full hover:bg-indigo-100 transition-colors"
              >Auction</a
            >
          </li>
          <li>
            <a
              href="#milestones"
              class="nav-link px-4 py-2 rounded-full hover:bg-indigo-100 transition-colors"
              >Milestones & NFTs</a
            >
          </li>
          <li>
            <button
              id="cart-button"
              class="relative hover:text-indigo-600 transition-colors px-4 py-2"
            >
              Cart
              <span
                id="cart-count-nav"
                class="absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
                >0</span
              >
            </button>
          </li>
        </ul>
        <div class="flex items-center">
          <button
            id="connectButton"
            class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-full hover:bg-indigo-700 transition-all transform hover:scale-105"
          >
            Connect Wallet
          </button>
          <!-- MODIFICATION START: Updated link to go directly to Coinbase dashboard -->
          <a
            id="walletInfo"
            href="https://wallet.coinbase.com/assets"
            target="_blank"
            rel="noopener noreferrer"
            class="hidden items-center justify-center bg-slate-100 hover:bg-slate-200 p-2 rounded-full transition-colors"
            title="Open Coinbase Wallet Dashboard"
          >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25-2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 3a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 3V9a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9" />
              </svg>
          </a>
          <!-- MODIFICATION END -->
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
      <section id="home-section" class="page-section text-center py-16">
        <h2 class="text-5xl md:text-6xl font-bold mb-4">
          Give Your Old Gadget a <span class="text-indigo-600">New Life</span>
        </h2>
        <p class="text-xl text-slate-600 max-w-3xl mx-auto mb-8">
          Buy, Sell, & Customize second-hand electronics in an aesthetic and
          cute way!
        </p>
        <a
          href="#shop"
          class="nav-link btn inline-block bg-pink-500 text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-pink-600 transition-all transform hover:scale-105 shadow-lg"
          >Shop Now</a
        >
      </section>

      <section id="shop-section" class="page-section hidden py-16">
        <h2 class="text-4xl font-bold text-center mb-12">All Products</h2>
        <div
          id="product-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8"
        ></div>
      </section>

      <section id="sell-section" class="page-section hidden py-16">
        <h2 class="text-4xl font-bold text-center mb-12">Sell Your Device</h2>
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-lg">
          <p class="text-center text-slate-600 mb-6">
            Ready to give your old tech a new home? Fill out the form below to
            get a quote. Our Web3 integration will ensure you get paid quickly
            and securely!
          </p>
          <form class="space-y-4">
            <div>
              <label for="device-type" class="block font-medium text-slate-700"
                >Device Type</label
              >
              <input
                type="text"
                id="device-type"
                class="w-full mt-1 p-2 border border-slate-300 rounded-md"
                placeholder="e.g., iPhone 12 Pro"
              />
            </div>
            <div>
              <label for="condition" class="block font-medium text-slate-700"
                >Condition</label
              >
              <select
                id="condition"
                class="w-full mt-1 p-2 border border-slate-300 rounded-md"
              >
                <option>Like New</option>
                <option>Good</option>
                <option>Fair</option>
              </select>
            </div>
            <div>
              <button
                type="submit"
                class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition-all"
              >
                Get Quote
              </button>
            </div>
          </form>
        </div>
      </section>

      <section id="diy-section" class="page-section hidden py-16">
        <h2 class="text-4xl font-bold text-center mb-12">
          DIY Customization Studio
        </h2>
        <div
          class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg flex flex-col md:flex-row gap-8 items-center"
        >
          <div class="w-full md:w-1/2">
            <img
              src="https://placehold.co/600x400/e0e7ff/4F46E5?text=Your+Design"
              id="diy-preview-img"
              alt="DIY Preview"
              class="rounded-lg shadow-md w-full h-auto object-cover"
            />
          </div>
          <div class="w-full md:w-1/2 space-y-6">
            <h3 class="text-2xl font-bold">Create Your Own Style</h3>
            <p class="text-slate-600">
              Pick a device, choose your colors, and upload your own design.
              Bring your vision to life!
            </p>
            <div class="space-y-4">
              <div>
                <label for="diy-device" class="block font-medium text-slate-700"
                  >1. Select Your Device</label
                >
                <select
                  id="diy-device"
                  class="w-full mt-1 p-2 border border-slate-300 rounded-md"
                >
                  <option>iPhone X</option>
                  <option>MacBook Air</option>
                  <option>Beats Solo</option>
                  <option>PlayStation 5</option>
                </select>
              </div>
              <div>
                <label for="diy-color" class="block font-medium text-slate-700"
                  >2. Choose a Base Color</label
                >
                <input
                  type="color"
                  id="diy-color"
                  class="w-full mt-1 h-10 p-1 border border-slate-300 rounded-md"
                  value="#d1fae5"
                />
              </div>
              <div>
                <label for="diy-upload" class="block font-medium text-slate-700"
                  >3. Upload a Design (Optional)</label
                >
                <input
                  type="file"
                  id="diy-upload"
                  accept="image/*"
                  class="w-full text-sm text-slate-500 mt-1 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
                />
              </div>
              <button
                class="w-full bg-pink-500 text-white font-bold py-3 rounded-lg hover:bg-pink-600 transition-all"
              >
                Submit for Quote
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="auction-section" class="page-section hidden py-16">
        <h2 class="text-4xl font-bold text-center mb-12">
          Rare & Collectible Auctions
        </h2>
        <p class="text-lg text-slate-600 max-w-2xl mx-auto text-center mb-10">
          Bid on one-of-a-kind, customized devices. These rare items are
          certified on-chain for authenticity.
        </p>
        <div
          id="auction-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"
        >
          <!-- Auction items will be injected here by JavaScript -->
        </div>
      </section>

      <section id="milestones-section" class="page-section hidden py-16">
        <h2 class="text-4xl font-bold text-center mb-12">
          Our Journey & Your Rewards
        </h2>
        <p class="text-lg text-slate-600 max-w-2xl mx-auto text-center mb-10">
          As our community grows, we hit new milestones. Active members are
          rewarded with exclusive NFTs to commemorate our journey together.
        </p>
        <div
          id="milestones-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"
        >
          <!-- Milestones & NFTs will be injected here by JavaScript -->
        </div>
      </section>
    </main>

    <footer class="bg-slate-800 text-slate-300 text-center py-8">
      <p>Â© 2025 reuseIT Electronics. All Rights Reserved.</p>
      <p class="mt-2">
        <a href="#" class="hover:text-white">About Us</a> |
        <a href="#" class="hover:text-white">Privacy Policy</a> |
        <a href="#" class="hover:text-white">Help & Support</a>
      </p>
    </footer>

    <div
      id="checkout-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 pointer-events-none z-50"
    >
      <div
        id="modal-content-checkout"
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8 transform scale-95"
      >
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-3xl font-bold">Your Cart</h2>
          <button
            class="close-modal-btn text-2xl font-bold text-slate-500 hover:text-slate-800"
          >
            &times;
          </button>
        </div>
        <div
          id="cart-items-container"
          class="max-h-60 overflow-y-auto pr-4 mb-4"
        ></div>
        <div class="border-t pt-4">
          <div id="cart-summary-container" class="mb-4">
            <button
              id="get-summary-btn"
              class="w-full bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-300 transition-all flex items-center justify-center space-x-2"
            >
              âœ¨ Get Cart Summary
            </button>
            <div
              id="summary-content"
              class="mt-4 p-4 bg-indigo-50 rounded-lg text-indigo-800 min-h-[50px] flex items-center justify-center text-center"
            >
              Click the button for an AI-powered summary!
            </div>
          </div>
          <div class="flex justify-between items-center text-xl font-bold mb-6">
            <span>Total:</span><span id="cart-total-display">â‚¹0.00</span>
          </div>
          <div id="payment-container">
            <h3 class="text-lg font-semibold text-center mb-4">
              Choose a Payment Method
            </h3>
            <div class="payment-options grid grid-cols-1 md:grid-cols-2 gap-4">
              <button
                id="coinbasePayBtn"
                class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center space-x-2"
              >
                <span>Pay with Coinbase</span>
              </button>
              <button
                id="cryptoPayBtn"
                class="w-full bg-orange-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-orange-600 transition-all transform hover:scale-105 flex items-center justify-center space-x-2"
              >
                <span>Pay On-Chain (ETH)</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      id="ideas-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 pointer-events-none z-50"
    >
      <div
        id="modal-content-ideas"
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8 transform scale-95"
      >
        <div class="flex justify-between items-center mb-4">
          <h2 id="ideas-modal-title" class="text-3xl font-bold">
            Customization Ideas
          </h2>
          <button
            class="close-modal-btn text-2xl font-bold text-slate-500 hover:text-slate-800"
          >
            &times;
          </button>
        </div>
        <div
          id="ideas-content"
          class="min-h-[200px] flex items-center justify-center text-slate-600"
        ></div>
      </div>
    </div>
    
    <div id="notification" class="fixed bottom-24 right-5 bg-green-500 text-white py-3 px-6 rounded-full shadow-lg opacity-0 transform translate-y-10"></div>

    <!-- Chatbot Container -->
    <div id="chatbot-container" class="fixed bottom-5 right-5 z-50">
        <div id="chatbot-window" class="absolute bottom-20 right-0 w-80 h-96 bg-white rounded-2xl shadow-2xl flex flex-col opacity-0 pointer-events-none transform translate-y-4">
            <div class="bg-indigo-600 text-white p-3 rounded-t-2xl"><h3 class="font-bold text-center">reuseIT Assistant</h3></div>
            <div id="chat-history" class="flex-grow p-3 overflow-y-auto"></div>
            <div class="p-2 border-t flex">
                <input type="text" id="chat-input" class="flex-grow border rounded-l-md p-2" placeholder="Ask a question...">
                <button id="chat-send-btn" class="bg-indigo-600 text-white px-4 rounded-r-md">Send</button>
            </div>
        </div>
        <button id="chatbot-toggle-btn" class="bg-indigo-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-lg text-3xl transform hover:scale-110 transition-transform">ðŸ¤–</button>
    </div>


    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const products = [
          {
            id: 1,
            name: "iPhone X - Floral Custom",
            price: 14999,
            image: "https://placehold.co/600x400/d1fae5/333?text=iPhone+X",
          },
          {
            id: 2,
            name: "MacBook Air - Pastel Skin",
            price: 32499,
            image: "https://placehold.co/600x400/e0e7ff/333?text=MacBook",
          },
          {
            id: 3,
            name: "Beats Solo - Anime Theme",
            price: 4499,
            image: "https://placehold.co/600x400/ffe4e6/333?text=Beats+Solo",
          },
          {
            id: 4,
            name: "PlayStation 5 - Custom Decals",
            price: 49999,
            image: "https://placehold.co/600x400/dbeafe/333?text=PS5",
          },
        ];

        const auctionItems = [
          {
            id: 101,
            name: "Vintage iPod - x402 Edition",
            image: "https://placehold.co/600x400/f3e8ff/4c1d95?text=iPod+x402",
            currentBid: 1.5,
            endsIn: "2d 4h",
          },
          {
            id: 102,
            name: "Transparent Game Boy",
            image: "https://placehold.co/600x400/dcfce7/14532d?text=Game+Boy",
            currentBid: 0.8,
            endsIn: "1d 8h",
          },
          {
            id: 103,
            name: "First-Gen iPhone (Sealed)",
            image: "https://placehold.co/600x400/fee2e2/991b1b?text=iPhone+2G",
            currentBid: 5.2,
            endsIn: "5d 1h",
          },
        ];

        const milestones = [
          {
            id: 201,
            name: "The 'x402' Founder NFT",
            image: "https://placehold.co/600x400/1e293b/94a3b8?text=x402+NFT",
            description:
              "A special NFT for early supporters of our platform. A symbol of your foundational role in our community.",
            status: "Claimable",
          },
          {
            id: 202,
            name: "1,000 Devices Recycled",
            image:
              "https://placehold.co/600x400/f0f9ff/0ea5e9?text=1000+Recycled",
            description:
              "Celebrating the first 1,000 devices given a new life through reuseIT. Thank you for making a difference!",
            status: "Achieved",
          },
          {
            id: 203,
            name: "First Community Design",
            image:
              "https://placehold.co/600x400/fff7ed/f97316?text=Community+Design",
            description:
              "This NFT marks the first product customized and sold based on a winning design from our community.",
            status: "Locked",
          },
        ];

        let cart = JSON.parse(localStorage.getItem("reuseIT-cart")) || [];
        let provider;
        let signer;

        const elements = {
          connectButton: document.getElementById("connectButton"),
          walletInfoDiv: document.getElementById("walletInfo"),
          cartCountNav: document.getElementById("cart-count-nav"),
          cartButton: document.getElementById("cart-button"),
          productGrid: document.getElementById("product-grid"),
          auctionGrid: document.getElementById("auction-grid"),
          milestonesGrid: document.getElementById("milestones-grid"),
          notification: document.getElementById("notification"),
          checkoutModal: document.getElementById("checkout-modal"),
          ideasModal: document.getElementById("ideas-modal"),
          modalContentCheckout: document.getElementById(
            "modal-content-checkout"
          ),
          modalContentIdeas: document.getElementById("modal-content-ideas"),
          closeModalBtns: document.querySelectorAll(".close-modal-btn"),
          cartItemsContainer: document.getElementById("cart-items-container"),
          cartTotalDisplay: document.getElementById("cart-total-display"),
          coinbasePayBtn: document.getElementById("coinbasePayBtn"),
          cryptoPayBtn: document.getElementById("cryptoPayBtn"),
          ideasModalTitle: document.getElementById("ideas-modal-title"),
          ideasContent: document.getElementById("ideas-content"),
          getSummaryBtn: document.getElementById("get-summary-btn"),
          summaryContent: document.getElementById("summary-content"),
          navLinks: document.querySelectorAll(".nav-link"),
          pageSections: document.querySelectorAll(".page-section"),
          diyUpload: document.getElementById("diy-upload"),
          diyPreviewImg: document.getElementById("diy-preview-img"),
          // Chatbot elements
          chatbotToggleBtn: document.getElementById("chatbot-toggle-btn"),
          chatbotWindow: document.getElementById("chatbot-window"),
          chatHistory: document.getElementById("chat-history"),
          chatInput: document.getElementById("chat-input"),
          chatSendBtn: document.getElementById("chat-send-btn"),
        };

        function showSection(targetId) {
          const sectionId = targetId.substring(1) + "-section";
          elements.pageSections.forEach((section) => {
            if (section.id === sectionId) {
              section.classList.remove("hidden");
            } else {
              section.classList.add("hidden");
            }
          });

          // Update active nav link style
          elements.navLinks.forEach((link) => {
            if (link.getAttribute("href") === targetId) {
              link.classList.add("bg-indigo-100", "text-indigo-600");
            } else {
              link.classList.remove("bg-indigo-100", "text-indigo-600");
            }
          });
        }

        async function connectWallet() {
          if (typeof window.ethereum !== "undefined") {
            try {
              provider = new ethers.providers.Web3Provider(window.ethereum, "any");
              await provider.send("eth_requestAccounts", []);
              signer = provider.getSigner();
              const address = await signer.getAddress();
              updateWalletUI(address);
              showNotification(
                `Wallet connected: ${address.substring(0, 6)}...`,
                "success"
              );
            } catch (error) {
              console.error("Wallet connection failed:", error);
              if (error.code === 4001) {
                 showNotification("Wallet connection was rejected.", "error");
              } else {
                 showNotification("Connection failed. See console for details.", "error");
              }
            }
          } else {
            showNotification("Wallet not found. Please install a browser wallet.", "info");
          }
        }

        function updateWalletUI(address) {
          if (!address) return;
          elements.connectButton.classList.add("hidden");
          elements.walletInfoDiv.classList.remove("hidden");
          elements.walletInfoDiv.classList.add("flex");
        }

        function addToCart(productId) {
          const product = products.find((p) => p.id == productId);
          if (!product) return;
          const existingItem = cart.find((item) => item.id == productId);
          if (existingItem) existingItem.quantity++;
          else cart.push({ ...product, quantity: 1 });
          saveCart();
          updateCartUI();
          showNotification(`${product.name} added to cart!`, "success");
        }

        function removeFromCart(productId) {
          cart = cart.filter((item) => item.id != productId);
          saveCart();
          updateCartUI();
          renderCartItems();
        }

        function saveCart() {
          localStorage.setItem("reuseIT-cart", JSON.stringify(cart));
        }

        function updateCartUI() {
          const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
          elements.cartCountNav.innerText = totalItems;
          const total = cart.reduce(
            (sum, item) => sum + item.price * item.quantity,
            0
          );
          elements.cartTotalDisplay.innerText = `â‚¹${total.toLocaleString()}`;
        }

        function renderProducts() {
          if (!elements.productGrid) return;
          elements.productGrid.innerHTML = "";
          products.forEach((product) => {
            elements.productGrid.innerHTML += `
                        <div class="product-card bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col justify-between transition-all duration-300 hover:shadow-2xl hover:-translate-y-2">
                             <img src="${product.image}" alt="${
              product.name
            }" class="h-48 w-full object-cover"/>
                            <div class="p-4 flex flex-col flex-grow">
                                <h3 class="text-xl font-semibold mb-2 flex-grow">${
                                  product.name
                                }</h3>
                                <p class="price text-2xl font-bold text-indigo-600 mb-4">â‚¹${product.price.toLocaleString()}</p>
                                <div class="space-y-2">
                                     <button class="add-to-cart w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-all" data-product-id="${
                                       product.id
                                     }">Add to Cart</button>
                                     <button class="get-ideas-btn w-full bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-300 transition-all" data-product-name="${
                                       product.name
                                     }">âœ¨ Get Ideas</button>
                                </div>
                            </div>
                        </div>`;
          });
        }

        function renderAuctionItems() {
          if (!elements.auctionGrid) return;
          elements.auctionGrid.innerHTML = "";
          auctionItems.forEach((item) => {
            elements.auctionGrid.innerHTML += `
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col justify-between transition-all duration-300 hover:shadow-2xl hover:-translate-y-2">
                             <img src="${item.image}" alt="${item.name}" class="h-56 w-full object-cover"/>
                            <div class="p-4 flex flex-col flex-grow">
                                <h3 class="text-xl font-semibold mb-2 flex-grow">${item.name}</h3>
                                <div class="flex justify-between items-baseline mb-4">
                                    <div>
                                        <p class="text-sm text-slate-500">Current Bid</p>
                                        <p class="text-2xl font-bold text-indigo-600">${item.currentBid} ETH</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-slate-500">Ends In</p>
                                        <p class="text-lg font-semibold">${item.endsIn}</p>
                                    </div>
                                </div>
                                <button class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-all">Place Bid</button>
                            </div>
                        </div>`;
          });
        }

        function renderMilestones() {
          if (!elements.milestonesGrid) return;
          elements.milestonesGrid.innerHTML = "";
          milestones.forEach((item) => {
            const isClaimable = item.status === "Claimable";
            const isAchieved = item.status === "Achieved";
            const buttonClass = isClaimable
              ? "bg-green-500 hover:bg-green-600"
              : "bg-slate-300 cursor-not-allowed";
            const buttonText = isClaimable
              ? "Claim NFT"
              : isAchieved
              ? "Achieved"
              : "Locked";

            elements.milestonesGrid.innerHTML += `
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col justify-between transition-all duration-300 hover:shadow-2xl hover:-translate-y-2">
                             <img src="${item.image}" alt="${
              item.name
            }" class="h-56 w-full object-cover"/>
                            <div class="p-4 flex flex-col flex-grow">
                                <h3 class="text-xl font-semibold mb-2">${
                                  item.name
                                }</h3>
                                <p class="text-slate-600 mb-4 flex-grow">${
                                  item.description
                                }</p>
                                <button class="w-full ${buttonClass} text-white font-bold py-2 px-4 rounded-lg transition-all" ${
              !isClaimable ? "disabled" : ""
            }>${buttonText}</button>
                            </div>
                        </div>`;
          });
        }

        function renderCartItems() {
          if (cart.length === 0) {
            elements.cartItemsContainer.innerHTML =
              '<p class="text-center text-slate-500">Your cart is empty.</p>';
            return;
          }
          elements.cartItemsContainer.innerHTML = cart
            .map(
              (item) => `
                    <div class="cart-item flex justify-between items-center py-3 border-b">
                        <div>
                            <p class="font-semibold">${item.name}</p>
                            <p class="text-sm text-slate-600">Quantity: ${
                              item.quantity
                            }</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <p class="font-semibold">â‚¹${(
                              item.price * item.quantity
                            ).toLocaleString()}</p>
                            <button class="cart-item-remove text-red-500 hover:text-red-700 font-bold" data-product-id="${
                              item.id
                            }">&times;</button>
                        </div>
                    </div>`
            )
            .join("");
        }

        function openModal(modal) {
          if (modal === elements.checkoutModal) renderCartItems();
          modal.classList.remove("opacity-0", "pointer-events-none");
          modal.querySelector(".modal-content").classList.remove("scale-95");
        }

        function closeModal(modal) {
          modal.classList.add("opacity-0", "pointer-events-none");
          modal.querySelector(".modal-content").classList.add("scale-95");
        }

        async function callGeminiAPI(prompt, systemInstruction = "") {
            // IMPORTANT: Replace with your actual Gemini API key for local testing.
            // GET YOUR KEY HERE: https://aistudio.google.com/app/apikey
            const apiKey = "AIzaSyCwYXHVQezk14LI9O4lOe83WoRZHqcPae8";
            
            if (!apiKey || apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                const errorMsg = "AI features are disabled. Please add a valid API key in the script.";
                console.error(errorMsg);
                return errorMsg;
            }
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
            };

            if (systemInstruction) {
                payload.systemInstruction = { parts: [{ text: systemInstruction }] };
            }

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("API call failed with status:", response.status, errorText);
                    throw new Error(`API request failed: ${errorText}`);
                }

                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    return text;
                } else {
                    console.error("Unexpected API response structure:", result);
                    throw new Error("Invalid API response");
                }
            } catch (error) {
                console.error('Gemini API call failed:', error);
                throw error;
            }
        }

        async function getCustomizationIdeas(productName) {
          elements.ideasModalTitle.innerText = `Ideas for ${productName}`;
          elements.ideasContent.innerHTML = '<div class="loader"></div>';
          openModal(elements.ideasModal);
          const prompt = `Generate 3 creative, aesthetic customization ideas for a used ${productName}. The themes should be trendy and visually appealing (e.g., cottagecore, cyberpunk, minimalist). For each idea, provide a theme name in bold, followed by a short, one-sentence description. Format as a simple list.`;
          try {
            let generatedText = await callGeminiAPI(prompt);
            generatedText = generatedText
              .replace(
                /\*\*(.*?)\*\*/g,
                '<strong class="text-indigo-600">$1</strong>'
              )
              .replace(/^\* (.*$)/gm, '<li class="mb-2">$1</li>')
              .replace(/\n/g, "<br>");
            elements.ideasContent.innerHTML = `<ul class="list-disc list-inside text-left">${generatedText}</ul>`;
          } catch (error) {
            elements.ideasContent.innerHTML =
              '<p class="text-red-500">Could not generate ideas. Please check if your API key is valid and try again later.</p>';
          }
        }

        async function getCartSummary() {
          if (cart.length === 0)
            return showNotification("Your cart is empty!", "info");
          elements.summaryContent.innerHTML = '<div class="loader"></div>';
          const productList = cart
            .map((item) => `${item.quantity}x ${item.name}`)
            .join(", ");
          const systemPrompt = `You are a friendly and enthusiastic tech assistant for 'reuseIT'.`
          const userPrompt = `Based on these items in a user's cart: [${productList}], write a short, fun, one-paragraph summary of what they're about to buy. Keep it under 50 words and be encouraging.`
          try {
            elements.summaryContent.textContent = await callGeminiAPI(userPrompt, systemPrompt);
          } catch (error) {
            elements.summaryContent.textContent =
              "Could not generate summary at this time.";
          }
        }
        
        function toggleChatbot() {
            const isHidden = elements.chatbotWindow.classList.contains('opacity-0');
            if (isHidden) {
                elements.chatbotWindow.classList.remove('opacity-0', 'pointer-events-none', 'translate-y-4');
            } else {
                elements.chatbotWindow.classList.add('opacity-0', 'pointer-events-none', 'translate-y-4');
            }
        }
        
        function appendMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('mb-2', 'p-2', 'rounded-lg', 'max-w-[85%]');
            messageDiv.textContent = message;
            if (sender === 'user') {
                messageDiv.classList.add('bg-indigo-100', 'self-end', 'text-right');
            } else {
                messageDiv.classList.add('bg-slate-200', 'self-start', 'text-left');
            }
            elements.chatHistory.appendChild(messageDiv);
            elements.chatHistory.scrollTop = elements.chatHistory.scrollHeight;
        }

        async function handleChatMessage() {
            const userMessage = elements.chatInput.value.trim();
            if (!userMessage) return;

            appendMessage(userMessage, 'user');
            elements.chatInput.value = '';
            
            const typingIndicator = document.createElement('div');
            typingIndicator.textContent = 'Assistant is typing...';
            typingIndicator.classList.add('text-slate-500', 'text-sm', 'self-start', 'p-2');
            elements.chatHistory.appendChild(typingIndicator);
            elements.chatHistory.scrollTop = elements.chatHistory.scrollHeight;

            const systemInstruction = "You are a friendly and helpful assistant for reuseIT, an online marketplace for buying, selling, and customizing used electronics. Your goal is to answer user questions concisely and clearly. Available products are: iPhone X, MacBook Air, Beats Solo, PlayStation 5.";
            
            try {
                const botResponse = await callGeminiAPI(userMessage, systemInstruction);
                typingIndicator.remove();
                appendMessage(botResponse, 'bot');
            } catch (error) {
                typingIndicator.remove();
                appendMessage("Sorry, I'm having trouble connecting. Please try again later.", 'bot');
            }
        }

        function payWithCoinbase() {
          if (!signer)
            return showNotification(
              "Please connect your wallet first.",
              "error"
            );
          showNotification(
            "Preparing Coinbase payment... (Simulation)",
            "info"
          );
          setTimeout(() => {
            showNotification(
              "Redirecting to Coinbase... (Simulated)",
              "success"
            );
            closeModal(elements.checkoutModal);
            cart = [];
            saveCart();
            updateCartUI();
          }, 2000);
        }

        function payWithCrypto() {
          if (!signer)
            return showNotification(
              "Please connect your wallet first.",
              "error"
            );
          showNotification(
            "Smart contract is not configured. This is a simulation.",
            "info"
          );
          setTimeout(() => {
            showNotification("Transaction successful! (Simulated)", "success");
            closeModal(elements.checkoutModal);
            cart = [];
            saveCart();
            updateCartUI();
          }, 2000);
        }

        function showNotification(message, type = "success") {
          elements.notification.innerText = message;
          elements.notification.className =
            "fixed bottom-24 right-5 text-white py-3 px-6 rounded-full shadow-lg opacity-0 transform translate-y-10";
          if (type === "error")
            elements.notification.classList.add("bg-red-500");
          else if (type === "info")
            elements.notification.classList.add("bg-blue-500");
          else elements.notification.classList.add("bg-green-500");
          setTimeout(() => {
            elements.notification.classList.remove(
              "opacity-0",
              "translate-y-10"
            );
          }, 10);
          setTimeout(() => {
            elements.notification.classList.add("opacity-0", "translate-y-10");
          }, 4000);
        }

        function handleDiyImageUpload(event) {
          const file = event.target.files[0];
          if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = (e) => {
              elements.diyPreviewImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
          } else {
            elements.diyPreviewImg.src =
              "https://placehold.co/600x400/e0e7ff/4F46E5?text=Your+Design";
          }
        }

        function initializeEventListeners() {
          elements.connectButton.addEventListener("click", connectWallet);
          
          elements.cartButton.addEventListener("click", () =>
            openModal(elements.checkoutModal)
          );
          elements.closeModalBtns.forEach((btn) =>
            btn.addEventListener("click", () => {
              closeModal(elements.checkoutModal);
              closeModal(elements.ideasModal);
            })
          );
          [elements.checkoutModal, elements.ideasModal].forEach((modal) =>
            modal.addEventListener("click", (e) => {
              if (e.target === modal) closeModal(modal);
            })
          );
          document.body.addEventListener("click", (e) => {
            if (e.target.closest(".add-to-cart")) {
              addToCart(e.target.closest(".add-to-cart").dataset.productId);
            }
            if (e.target.closest(".cart-item-remove")) {
              removeFromCart(
                e.target.closest(".cart-item-remove").dataset.productId
              );
            }
            if (e.target.closest(".get-ideas-btn")) {
              getCustomizationIdeas(
                e.target.closest(".get-ideas-btn").dataset.productName
              );
            }
          });
          elements.coinbasePayBtn.addEventListener("click", payWithCoinbase);
          elements.cryptoPayBtn.addEventListener("click", payWithCrypto);
          elements.getSummaryBtn.addEventListener("click", getCartSummary);
          if (elements.diyUpload) {
            elements.diyUpload.addEventListener("change", handleDiyImageUpload);
          }
          elements.navLinks.forEach((link) => {
            link.addEventListener("click", (e) => {
              e.preventDefault();
              const targetId = link.getAttribute("href");
              if (
                targetId.startsWith("#") &&
                document.getElementById(targetId.substring(1) + "-section")
              ) {
                showSection(targetId);
              }
            });
          });

          elements.chatbotToggleBtn.addEventListener("click", toggleChatbot);
          elements.chatSendBtn.addEventListener("click", handleChatMessage);
          elements.chatInput.addEventListener("keyup", (e) => {
              if (e.key === 'Enter') handleChatMessage();
          });
        }

        function init() {
          renderProducts();
          renderAuctionItems();
          renderMilestones();
          updateCartUI();
          initializeEventListeners();
          const hash = window.location.hash || "#home";
          showSection(hash);
        }

        init();
      });
    </script>
  </body>
</html>

